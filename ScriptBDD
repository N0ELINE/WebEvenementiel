-- USER(idUser, Mail, hashMdp, #droit)
-- DROITS(idDroits, libelleDroit)
-- NOTIF(idNotif, date,heure, contenu)
-- NOTIFIE (idUserNotifie, idNotifNotifie, consulte)
-- PHOTOSITE(idPhoto, lien)
-- ARTICLE(idArticle, nom, prenom, description, contenu, date, #idPhotoArticle)
-- COMMENTAIRE(idCommentaire, contenu, #idArticleCommentaire, #idUserCommentaire)
-- FAVORI(#idUserFavori, #idArticleFavori)
-- EVENT(idEvent, nom, description, date, heure, dureeMinute, effectifMax, localisation, #idPhotoEvent)
-- PARTICIPE(#idEventParticipe, #idUserParticipe, nbrPersonnes)
-- GALERIEEVENT(#idEventGalerie, #idPhotoGalerie)
-- TYPEFORMATION(idType, libelleFormation)
-- DIFFICULTEE(idDifficultée, libelleDifficultée)
-- FORMATION(idFormation, nom, description, #idTypeFormation, #idDifficulteeFormation)
-- COMMENCE(#idFormationCommence, #idUserCommence, avancement, datedebut)
-- AVIS(idAvis, contenu, etoiles, #idUserAvis)
-- AVISFORMATION(#idFormationAvis, #idAvisFormation)
-- AVISEVENT(#idEventAvis, #idAvisEvent)
-- LOGS(#idUserLogs, dateu, heure)


DROP DATABASE STAREVENT;

CREATE DATABASE STAREVENT;
use STAREVENT;

CREATE USER 'webuser'@'%' IDENTIFIED BY '123+aze';
GRANT ALL PRIVILEGES ON STAREVENT TO 'webuser'@'%';
GRANT ALL PRIVILEGES ON *.* TO 'webuser'@'%';
FLUSH PRIVILEGES;

CREATE TABLE DROITS(
    idDroits INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    libelleDroit VARCHAR(100)
);
INSERT INTO DROITS (libelleDroit) VALUES ('client');
INSERT INTO DROITS (libelleDroit) VALUES ('salarie');
INSERT INTO DROITS (libelleDroit) VALUES ('admin');
-- droit 1 = client 2 = salarie 3= admin

CREATE TABLE USER(
    idUser INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    Mail VARCHAR(100),
    hashMdp VARCHAR(255),
    droit INT,
    FOREIGN KEY (droit) REFERENCES DROITS(idDroits)
);
INSERT INTO USER (Mail,hashMdp,droit) VALUES ('client1@gmail.com', '',1);
INSERT INTO USER (Mail,hashMdp,droit) VALUES ('salarie2@gmail.com', '123+aze',2);
INSERT INTO USER (Mail,hashMdp,droit) VALUES ('admin3@gmail.com', '123+aze',3);



CREATE TABLE NOTIF(
    idNotif INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    date DATE,
    heure TIME,
    contenu VARCHAR(100)
);

CREATE TABLE NOTIFIE(
    idUserNotifie INT NOT NULL, 
    idNotifNotifie INT NOT NULL, 
    consulte BOOLEAN DEFAULT false,
    PRIMARY KEY (idUserNotifie, idNotifNotifie),
    FOREIGN KEY (idUserNotifie) REFERENCES USER(idUser) ,
    FOREIGN KEY (idNotifNotifie) REFERENCES NOTIF(idNotif)
);

CREATE TABLE PHOTOSITE(
    idPhoto INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    lien VARCHAR(200)
);

CREATE TABLE ARTICLE(
    idArticle INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    nom VARCHAR(100),
    description VARCHAR(500),
    contenu VARCHAR(10000),
    date DATE,
    idPhotoArticle INT,
    FOREIGN KEY (idPhotoArticle) REFERENCES PHOTOSITE(idPhoto)
);
INSERT INTO ARTICLE (nom,description,contenu) VALUES ("Todo list EVJF","comment ne rien coublier dans la préparation d'un EVJF","Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.");
INSERT INTO ARTICLE (nom,description,contenu) VALUES ("Le mariage quelle mauvaise idée","les hommes viennent de mars et les hommes de venus","Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.");
INSERT INTO ARTICLE (nom,description,contenu) VALUES ("Un anniversaire POKEMON","des idées de déco DIY","Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.");



CREATE TABLE COMMENTAIRE(
    idCommentaire INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    idArticleCommentaire INT NOT NULL,
    contenu VARCHAR(1000),
    idPhotoArticle int,
    IdUserCommentaire int,
    FOREIGN KEY (idArticleCommentaire) REFERENCES ARTICLE(idArticle),
    FOREIGN KEY (idUserCommentaire) REFERENCES USER(idUser)
);

CREATE TABLE FAVORI(
    idUserFavori INT NOT NULL ,
    idArticleFavori INT  NOT NULL ,
    PRIMARY KEY (idUserFavori, idArticleFavori),
    FOREIGN KEY (idUserFavori) REFERENCES USER(idUser),
    FOREIGN KEY (idArticleFavori) REFERENCES ARTICLE(idArticle)
);

CREATE TABLE EVENEMENT(
    idEvent INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    nom VARCHAR(100),
    description VARCHAR(1000),
    date DATE,
    heure TIME,
    dureeMinute INT,
    effectifMax INT,
    localisation VARCHAR(1000),
    idPhotoEvent INT,
    FOREIGN KEY (idPhotoEvent) REFERENCES PHOTOSITE(idPhoto)
);
INSERT INTO EVENEMENT (nom,description) VALUES ("DIY Party","par la blogueuse Emilie");
INSERT INTO EVENEMENT (nom,description) VALUES ("Soirée Karaoké","sur le dance floooor");


CREATE TABLE PARTICIPE(
    idEventParticipe INT NOT NULL,
    idUserParticipe INT NOT NULL,
    nbrPersonnes INT,
    PRIMARY KEY (idUserParticipe, idEventParticipe),
    FOREIGN KEY (idUserParticipe) REFERENCES USER(idUser),
    FOREIGN KEY (idEventParticipe) REFERENCES Event(idEvent)
);

CREATE TABLE GALERIEEvent(
    idEventGalerie INT NOT NULL,
    idPhotoGalerie INT NOT NULL,
    PRIMARY KEY (idEventGalerie, idPhotoGalerie),
    FOREIGN KEY (idPhotoGalerie) REFERENCES PHOTOSITE(idPhoto),
    FOREIGN KEY (idEventGalerie) REFERENCES Event(idEvent)
);

CREATE TABLE TYPEFORMATION(
    idType INT PRIMARY KEY NOT NULL,
    libelleFormation VARCHAR(100)
);
INSERT INTO TYPEFORMATION (idType,libelleFormation) VALUES (1,"Rapide");
INSERT INTO TYPEFORMATION (idType,libelleFormation) VALUES (2,"Medium");
INSERT INTO TYPEFORMATION (idType,libelleFormation) VALUES (3,"Longue");


CREATE TABLE DIFFICULTEE(
    idDifficultée INT PRIMARY KEY NOT NULL,
    libelleDifficultée VARCHAR(100)
);
INSERT INTO DIFFICULTEE (idDifficultée,libelleDifficultée) VALUES (1,"facile");
INSERT INTO DIFFICULTEE (idDifficultée,libelleDifficultée) VALUES (2,"moyen");
INSERT INTO DIFFICULTEE (idDifficultée,libelleDifficultée) VALUES (3,"difficile");
CREATE TABLE FORMATION(
    idFormation INT PRIMARY KEY NOT NULL,
    nom VARCHAR(200),
    description VARCHAR(500),
    dureeHeure INT,
    idTypeFormation INT,
    idDifficultéeFormation INT,
    FOREIGN KEY (idTypeFormation) REFERENCES TYPEFORMATION(idType),
    FOREIGN KEY (idDifficultéeFormation) REFERENCES DIFFICULTEE(idDifficultée)
);

INSERT INTO FORMATION (idFormation,nom,description,dureeHeure,idTypeFormation,idDifficultéeFormation) VALUES (1,"Formation fête","Formation d'organisation de fête",3,1,1);
INSERT INTO FORMATION (idFormation,nom,description,dureeHeure,idTypeFormation,idDifficultéeFormation) VALUES (2,"Formation Enterrement","Formation d'organisation d'enterrement'",5,2,2);
INSERT INTO FORMATION (idFormation,nom,description,dureeHeure,idTypeFormation,idDifficultéeFormation) VALUES (3,"Formation truc&Astuce","Formation d'aide de déco",23,3,3);

CREATE TABLE COMMENCE(
    idFormationCommence INT NOT NULL,
    idUserCommence INT NOT NULL,
    avancement INT DEFAULT 0,
    dateDebut DATE,
    PRIMARY KEY (idFormationCommence, idUserCommence),
    FOREIGN KEY (idUserCommence) REFERENCES USER(idUser),
    FOREIGN KEY (idFormationCommence) REFERENCES FORMATION(idFormation)
);

CREATE TABLE AVIS(
    idAvis INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    contenu VARCHAR(1000),
    etoiles INT default 0,
    idUserAvis INT,
    FOREIGN KEY (idUserAvis) REFERENCES USER(idUser)
);
INSERT INTO FORMATION (contenu,etoiles,idUserAvis) VALUES ("azertyuio",5,1);


CREATE TABLE AVISFORMATION(
    idFormationAvis INT  NOT NULL,
    idAvisFormation INT  NOT NULL,
    PRIMARY KEY (idFormationAvis, idAvisFormation),
    FOREIGN KEY (idFormationAvis) REFERENCES FORMATION(idFormation),
    FOREIGN KEY (idAvisFormation) REFERENCES AVIS(idAvis)
);

CREATE TABLE AVISEVENT(
    idEvent INT NOT NULL,
    idAvis INT NOT NULL,
    PRIMARY KEY (idEvent, idAvis),
    FOREIGN KEY (idEvent) REFERENCES EVENEMENT(idEvent),
    FOREIGN KEY (idAvis) REFERENCES AVIS(idAvis)
);

CREATE TABLE LOGS(
    idUserLogs INT NOT NULL,
    dateu DATE NOT NULL,
    heure TIME NOT NULL,
    PRIMARY KEY (idUserLogs, dateu, heure),
    FOREIGN KEY (idUserLogs) REFERENCES USER(idUser)
    );
    
CREATE TABLE QUESTIONS(
    idQuestion INT PRIMARY KEY  NOT NULL,
    idQuestionFormation INT NOT NULL,
    libelle VARCHAR(500) NOT NULL,
    FOREIGN KEY (idQuestionFormation) REFERENCES FORMATION(idFormation)
    );
INSERT INTO QUESTIONS (idQuestion,idQuestionFormation,libelle) VALUES (1,1,"Comment organiser un mariage?");
INSERT INTO QUESTIONS (idQuestion,idQuestionFormation,libelle) VALUES (2,2,"Comment organiser un enterrement?");
INSERT INTO QUESTIONS (idQuestion,idQuestionFormation,libelle) VALUES (3,3,"Quelle est le nom de ce site?");


CREATE TABLE REPONSES(
    idReponses INT PRIMARY KEY NOT NULL,
    idReponseQuestion INT NOT NULL,
    libelle VARCHAR(500) NOT NULL,
    bonne_rep BOOLEAN,
    FOREIGN KEY (idReponseQuestion) REFERENCES QUESTIONS(idQuestion)
    );
INSERT INTO REPONSES (idReponses,idReponseQuestion,libelle,bonne_rep) VALUES (1,1,"Avec de la patience",true);
INSERT INTO REPONSES (idReponses,idReponseQuestion,libelle,bonne_rep) VALUES (2,1,"Avec des coups de poingts",false);
INSERT INTO REPONSES (idReponses,idReponseQuestion,libelle,bonne_rep) VALUES (3,1,"Avec des des crêpes",false);

INSERT INTO REPONSES (idReponses,idReponseQuestion,libelle,bonne_rep) VALUES (4,2,"Avec de la finesse",true);
INSERT INTO REPONSES (idReponses,idReponseQuestion,libelle,bonne_rep) VALUES (5,2,"Avec des des blagues pas drôle",false);
INSERT INTO REPONSES (idReponses,idReponseQuestion,libelle,bonne_rep) VALUES (6,2,"Avec des des chamignons",false);


INSERT INTO REPONSES (idReponses,idReponseQuestion,libelle,bonne_rep) VALUES (7,3,"StarEvent",true);
INSERT INTO REPONSES (idReponses,idReponseQuestion,libelle,bonne_rep) VALUES (8,3,"MoonEvent",false);
INSERT INTO REPONSES (idReponses,idReponseQuestion,libelle,bonne_rep) VALUES (9,3,"SunEvent",false);


-- CREATE TABLE CONTACT(
--     idEvent INT PRIMARY KEY NOT NULL,
--     mail VARCHAR(500),
--     nom VARCHAR(100),
--     prenom VARCHAR(100),
--     societe VARCHAR(100),
--     tel INT,
--     sujet VARCHAR(200),
--     message VARCHAR(50000)
-- );
